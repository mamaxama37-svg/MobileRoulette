<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live Roulette Analyzer</title>
<style>
body { background:#000; color:#fff; font-family:Arial; margin:0; text-align:center; }
header { background:#111; padding:12px; font-size:1.3em; }
#videoContainer { position:relative; width:100%; max-width:600px; margin:auto; }
video, canvas { width:100%; border:2px solid #fff; }
#controls { margin:10px; }
#status, #prediction, #numbers { margin:6px; padding:6px; background:#222; border-radius:6px; }
button { padding:8px 12px; margin:6px; font-size:1em; }
</style>
</head>
<body>

<header>Live Mobile Roulette Analyzer</header>

<div id="videoContainer">
  <video id="rouletteVideo" autoplay muted></video>
  <canvas id="canvas"></canvas>
</div>

<div id="controls">
  <button id="startBtn">Start Detection</button>
  <button id="stopBtn">Stop Detection</button>
</div>

<div id="status">Status: Waitingâ€¦</div>
<div id="numbers">Last 100 Numbers: --</div>
<div id="prediction">Next Prediction: --</div>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
<script>
const wheel = [0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26];
let lastNumbers = [];
let detectionActive = false;

const video = document.getElementById('rouletteVideo');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const statusEl = document.getElementById('status');
const numbersEl = document.getElementById('numbers');
const predictionEl = document.getElementById('prediction');

async function startCamera() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: { exact: "environment" } },
      audio: false
    });
    video.srcObject = stream;
    video.onloadedmetadata = () => {
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
    };
    statusEl.innerText = "Camera started.";
  } catch(err) {
    statusEl.innerText = "Camera error: " + err;
  }
}

async function detectFrame() {
  if(!detectionActive) return;
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

  // TODO: Crop each number square from the image and preprocess (grayscale/contrast)
  // For now we simulate detection with random numbers
  // Replace this with Tesseract.js OCR per number square
  let simulatedNumber = Math.floor(Math.random()*37); 
  if(lastNumbers.length===0 || lastNumbers[lastNumbers.length-1]!==simulatedNumber) {
    lastNumbers.push(simulatedNumber);
    if(lastNumbers.length>100) lastNumbers.shift();
  }

  numbersEl.innerText = "Last 100 Numbers: " + lastNumbers.join(", ");

  // Prediction logic
  const freq = {};
  lastNumbers.forEach(n=>freq[n]=(freq[n]||0)+1);
  const sorted = Object.entries(freq).sort((a,b)=>b[1]-a[1]);
  const topNum = parseInt(sorted[0][0]);
  const neighbor = wheel[(wheel.indexOf(topNum)+1)%37]; // simple neighbor
  predictionEl.innerText = `Next Prediction: ${topNum} | Neighbor: ${neighbor}`;

  requestAnimationFrame(detectFrame);
}

document.getElementById('startBtn').addEventListener('click', ()=>{
  detectionActive = true;
  detectFrame();
});

document.getElementById('stopBtn').addEventListener('click', ()=>{
  detectionActive = false;
  statusEl.innerText = "Detection stopped.";
});

startCamera();
</script>

</body>
</html>
