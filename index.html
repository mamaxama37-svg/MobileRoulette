<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live Roulette Analyzer - Mobile</title>
<style>
body { background:#000; color:#fff; font-family:sans-serif; margin:0; text-align:center; }
header { background:#111; padding:12px; font-size:1.4em; }
#videoContainer { position:relative; width:100%; max-width:600px; margin:auto; }
video { width:100%; border:2px solid #fff; }
canvas { display:none; }
button { padding:8px 12px; margin:6px; font-size:1em; }
#status { margin:10px; font-size:1em; }
#prediction { margin:10px; font-size:1.1em; font-weight:bold; }
#neighbors { margin:10px; font-size:1em; }
</style>
</head>
<body>

<header>Live Roulette Analyzer</header>

<div id="videoContainer">
<video id="rouletteVideo" autoplay playsinline></video>
</div>

<button id="captureBtn">Capture Last 100 Numbers</button>

<div id="status">Status: Waiting...</div>
<div id="prediction">Macro Sector (Top 3): --</div>
<div id="neighbors">Top 2 Neighbors: --</div>

<canvas id="canvas"></canvas>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
<script>
const wheel = [0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26];
let history = []; // last 100 numbers
const video = document.getElementById('rouletteVideo');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

async function startCamera() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' }, audio:false });
    video.srcObject = stream;
  } catch(e) {
    alert('Camera error: '+e);
  }
}

function preprocessFrame() {
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  ctx.drawImage(video,0,0,canvas.width,canvas.height);

  let imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
  let data = imageData.data;

  // convert to grayscale and threshold
  for(let i=0;i<data.length;i+=4){
    let r=data[i], g=data[i+1], b=data[i+2];
    let gray = 0.299*r + 0.587*g + 0.114*b;
    if(gray>150) { data[i]=data[i+1]=data[i+2]=255; }
    else { data[i]=data[i+1]=data[i+2]=0; }
  }
  ctx.putImageData(imageData,0,0);
}

async function captureNumbers() {
  document.getElementById('status').innerText = 'Processing screenshot...';
  preprocessFrame();

  const result = await Tesseract.recognize(canvas, 'eng', { logger: m => {} });
  let nums = result.data.text.match(/\b([0-9]|[1-2][0-9]|3[0-6])\b/g);
  if(!nums || nums.length<50){
    document.getElementById('status').innerText = 'OCR failed: numbers unclear';
    return;
  }

  nums = nums.map(Number).slice(-100); // last 100
  history = nums;
  document.getElementById('status').innerText = 'Detected last 100 numbers: '+history.join(', ');

  runPrediction();
}

function getNeighbors(number, count=1){
  const idx = wheel.indexOf(number);
  const neighbors = [];
  for(let i=1;i<=count;i++){
    neighbors.push(wheel[(idx+i)%37]);
    neighbors.push(wheel[(idx-i+37)%37]);
  }
  return neighbors;
}

function runPrediction() {
  if(history.length===0) return;

  // Macro sector top 3
  const heat = Array(37).fill(0);
  history.forEach(n=>{
    const idx = wheel.indexOf(n);
    for(let i=-1;i<=1;i++) heat[(idx+i+37)%37]++;
  });

  let sector = [];
  for(let i=0;i<3;i++){
    const max = Math.max(...heat);
    const idx = heat.indexOf(max);
    sector.push(wheel[idx]);
    heat[idx]=0;
  }

  document.getElementById('prediction').innerText = 'Macro Sector (Top 3): '+sector.join(', ');

  // Top 2 neighbor prediction based on last number
  const lastNum = history[history.length-1];
  const neighbors = getNeighbors(lastNum,1);
  document.getElementById('neighbors').innerText = 'Top 2 Neighbors: '+neighbors.join(', ');
}

document.getElementById('captureBtn').addEventListener('click', captureNumbers);

startCamera();
</script>

</body>
</html>
