<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pro Live Roulette Analyzer</title>
<style>
body { background:#000; color:#fff; font-family:Arial; margin:0; text-align:center; }
header { background:#111; padding:12px; font-size:1.3em; }
#videoContainer { position:relative; width:100%; max-width:600px; margin:auto; }
video, canvas { width:100%; border:2px solid #fff; }
#controls { margin:10px; }
#status, #numbers, #prediction, #sectors { margin:6px; padding:6px; background:#222; border-radius:6px; }
button { padding:8px 12px; margin:6px; font-size:1em; }
</style>
</head>
<body>

<header>Pro Live Mobile Roulette Analyzer</header>

<div id="videoContainer">
  <video id="rouletteVideo" autoplay muted></video>
  <canvas id="canvas"></canvas>
</div>

<div id="controls">
  <button id="startBtn">Start Detection</button>
  <button id="stopBtn">Stop Detection</button>
</div>

<div id="status">Status: Waitingâ€¦</div>
<div id="numbers">Last 100 Numbers: --</div>
<div id="prediction">Next Prediction: --</div>
<div id="sectors">Top 3 Sectors: --</div>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
<script>
const wheel = [0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,
               30,8,23,10,5,24,16,33,1,20,14,31,9,
               22,18,29,7,28,12,35,3,26];

let lastNumbers = [];
let detectionActive = false;
let prevAngle = null;
let prevTime = null;
let ballSpeed = 0;

const video = document.getElementById('rouletteVideo');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const statusEl = document.getElementById('status');
const numbersEl = document.getElementById('numbers');
const predictionEl = document.getElementById('prediction');
const sectorsEl = document.getElementById('sectors');

// Start back camera
async function startCamera() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: { exact: "environment" } },
      audio: false
    });
    video.srcObject = stream;
    video.onloadedmetadata = () => {
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
    };
    statusEl.innerText = "Camera started.";
  } catch(err) {
    statusEl.innerText = "Camera error: " + err;
  }
}

// OCR & Ball Detection per frame
async function detectFrame() {
  if(!detectionActive) return;
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

  // --- Ball Detection ---
  const imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
  const ball = detectBall(imageData);
  if(ball) trackBall(ball);

  // --- OCR Detection (simulate for now, replace with Tesseract for each number square) ---
  let simulatedNumber = Math.floor(Math.random()*37); 
  if(lastNumbers.length===0 || lastNumbers[lastNumbers.length-1]!==simulatedNumber){
    lastNumbers.push(simulatedNumber);
    if(lastNumbers.length>100) lastNumbers.shift();
  }

  numbersEl.innerText = "Last 100 Numbers: " + lastNumbers.join(", ");

  // --- Prediction ---
  const freq = {};
  lastNumbers.forEach(n=>freq[n]=(freq[n]||0)+1);
  const sorted = Object.entries(freq).sort((a,b)=>b[1]-a[1]);
  const topNum = parseInt(sorted[0][0]);
  const neighbor = wheel[(wheel.indexOf(topNum)+1)%37];
  predictionEl.innerText = `Next Prediction: ${topNum} | Neighbor: ${neighbor}`;

  // Top 3 sectors calculation
  const heat = Array(37).fill(0);
  lastNumbers.forEach(n=>{
    const idx = wheel.indexOf(n);
    for(let i=-1;i<=1;i++) heat[(idx+i+37)%37]++;
  });
  const topSectors = [];
  heat.forEach((v,i)=>topSectors.push({n:wheel[i],v}));
  topSectors.sort((a,b)=>b.v-a.v);
  sectorsEl.innerText = "Top 3 Sectors: "+topSectors.slice(0,3).map(x=>x.n).join(", ");

  requestAnimationFrame(detectFrame);
}

// Simple white ball detection (placeholder)
function detectBall(imageData){
  // Implement color thresholding to find the white ball
  return {x:canvas.width/2, y:canvas.height/2}; 
}

// Track angular speed
function trackBall(ball){
  const centerX=canvas.width/2, centerY=canvas.height/2;
  const now = performance.now();
  const angle = Math.atan2(ball.y-centerY, ball.x-centerX);
  if(prevAngle!==null){
    const dt = (now-prevTime)/1000;
    ballSpeed = (angle-prevAngle)/dt;
  }
  prevAngle = angle;
  prevTime = now;
}

document.getElementById('startBtn').addEventListener('click', ()=>{
  detectionActive = true;
  detectFrame();
});

document.getElementById('stopBtn').addEventListener('click', ()=>{
  detectionActive = false;
  statusEl.innerText = "Detection stopped.";
});

startCamera();
</script>

</body>
</html>
