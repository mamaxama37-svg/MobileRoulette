<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live Roulette Analyzer</title>
<style>
body { background:#000; color:#fff; font-family:Arial; margin:0; text-align:center; }
header { background:#111; padding:12px; font-size:1.3em; }
#videoContainer { position:relative; width:100%; max-width:600px; margin:auto; }
video, canvas { width:100%; border:2px solid #fff; }
#controls { margin:10px; }
#status, #numbers, #prediction { margin:6px; padding:6px; background:#222; border-radius:6px; }
button { padding:8px 12px; margin:6px; font-size:1em; }
</style>
</head>
<body>

<header>Live Mobile Roulette Analyzer</header>

<div id="videoContainer">
  <video id="rouletteVideo" autoplay muted></video>
  <canvas id="canvas"></canvas>
</div>

<div id="controls">
  <button id="startBtn">Start Detection</button>
  <button id="stopBtn">Stop Detection</button>
</div>

<div id="status">Status: Waitingâ€¦</div>
<div id="numbers">Last 100 Numbers: --</div>
<div id="prediction">Next Prediction: --</div>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
<script>
// ===== WHEEL MODEL =====
const wheel = [0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,
30,8,23,10,5,24,16,33,1,20,14,31,9,
22,18,29,7,28,12,35,3,26];

let lastNumbers = [];
let detectionActive = false;

const video = document.getElementById('rouletteVideo');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const statusEl = document.getElementById('status');
const numbersEl = document.getElementById('numbers');
const predictionEl = document.getElementById('prediction');

// ===== START CAMERA =====
async function startCamera() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: { exact: "environment" } },
      audio: false
    });
    video.srcObject = stream;
    video.onloadedmetadata = () => {
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
    };
    statusEl.innerText = "Camera started.";
  } catch(err) {
    statusEl.innerText = "Camera error: " + err;
  }
}

// ===== DETECT FRAME =====
async function detectFrame() {
  if(!detectionActive) return;
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

  // ===== OCR NUMBER DETECTION =====
  // Coordinates are sample values for typical mobile view
  // You may adjust per your camera angle
  const squares = [
    {x:50,y:200,w:50,h:50}, {x:110,y:200,w:50,h:50}, {x:170,y:200,w:50,h:50},
    {x:230,y:200,w:50,h:50}, {x:290,y:200,w:50,h:50}, {x:350,y:200,w:50,h:50},
    {x:410,y:200,w:50,h:50}, {x:470,y:200,w:50,h:50} // Add more if needed
  ];

  for(const sq of squares){
    const imageData = ctx.getImageData(sq.x,sq.y,sq.w,sq.h);
    const tempCanvas = document.createElement('canvas');
    tempCanvas.width = sq.w;
    tempCanvas.height = sq.h;
    tempCanvas.getContext('2d').putImageData(imageData,0,0);

    try{
      const result = await Tesseract.recognize(tempCanvas,'eng',{ 
        logger:m=>console.log(m) 
      });
      const num = parseInt(result.data.text.replace(/\D/g,''));
      if(!isNaN(num) && num>=0 && num<=36){
        if(lastNumbers.length===0 || lastNumbers[lastNumbers.length-1]!==num){
          lastNumbers.push(num);
          if(lastNumbers.length>100) lastNumbers.shift();
        }
      }
    } catch(e){
      console.log("OCR error:", e);
    }
  }

  numbersEl.innerText = "Last 100 Numbers: " + lastNumbers.join(", ");

  // ===== PREDICTION =====
  if(lastNumbers.length>0){
    const freq = {};
    lastNumbers.forEach(n=>freq[n]=(freq[n]||0)+1);
    const sorted = Object.entries(freq).sort((a,b)=>b[1]-a[1]);
    const topNum = parseInt(sorted[0][0]);
    const neighbor = wheel[(wheel.indexOf(topNum)+1)%37]; // 1 neighbor
    predictionEl.innerText = `Next Prediction: ${topNum} | Neighbor: ${neighbor}`;
  }

  requestAnimationFrame(detectFrame);
}

// ===== BUTTONS =====
document.getElementById('startBtn').addEventListener('click', ()=>{
  detectionActive = true;
  detectFrame();
  statusEl.innerText="Detection started...";
});

document.getElementById('stopBtn').addEventListener('click', ()=>{
  detectionActive = false;
  statusEl.innerText="Detection stopped.";
});

startCamera();
</script>
</body>
</html>
