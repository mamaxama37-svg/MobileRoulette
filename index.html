<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live Roulette Analyzer</title>
<style>
body { margin:0; font-family:Arial; background:#000; color:#fff; text-align:center;}
header{background:#111;padding:10px;font-size:1.3em;}
#videoContainer{position:relative;width:100%;max-width:600px;margin:auto;}
video{width:100%;border:2px solid #fff;}
canvas{position:absolute;top:0;left:0;}
#stats{margin-top:10px;font-size:0.9em;}
.statBox{background:#222;padding:8px;margin:4px;border-radius:5px;}
</style>
</head>
<body>
<header>Live Roulette Analyzer</header>
<div id="videoContainer">
  <video id="cameraVideo" autoplay playsinline></video>
  <canvas id="overlay"></canvas>
</div>

<div id="stats">
  <div class="statBox" id="ballSpeed">Ball Speed: -- rad/s</div>
  <div class="statBox" id="lastNumbers">Last Numbers: --</div>
  <div class="statBox" id="prediction">Next Prediction: --</div>
  <div class="statBox" id="topSectors">Top 3 Sectors: --</div>
  <div class="statBox" id="topNeighbors">Top 5 Neighbors: --</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
<script>
// ===== Wheel Setup =====
const wheel=[0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,
30,8,23,10,5,24,16,33,1,20,14,31,9,
22,18,29,7,28,12,35,3,26];

let history=[], lastNumber=-1;
let prevAngle=null, prevTime=null, currentSpeed=0;
let topSectors=[], topNeighbors=[];

// ===== Camera Setup =====
const video=document.getElementById('cameraVideo');
const canvas=document.getElementById('overlay');
const ctx=canvas.getContext('2d');

navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}})
.then(stream => video.srcObject = stream)
.catch(e=>alert("Camera access denied"));

// ===== OCR Placeholder (You can extend) =====
async function detectNumber(frame) {
  // This can be extended with Tesseract OCR on the frame
  // For demo: return a random number
  const num = Math.floor(Math.random()*37);
  return num;
}

// ===== Ball Detection Placeholder =====
function detectBall(frameCtx){
  // This should process the frame and find the bright moving ball
  // For demo: simulate random coordinates
  return {x:Math.random()*canvas.width, y:Math.random()*canvas.height};
}

// ===== Track Ball Motion =====
function trackBall(ball){
  const centerX=canvas.width/2, centerY=canvas.height/2;
  const now=performance.now();
  const angle=Math.atan2(ball.y-centerY, ball.x-centerX);
  if(prevAngle!==null){
    const dt=(now-prevTime)/1000;
    currentSpeed=(angle-prevAngle)/dt;
  }
  prevAngle=angle; prevTime=now;
}

// ===== Analyze Frame =====
async function analyzeFrame(){
  canvas.width=video.videoWidth;
  canvas.height=video.videoHeight;
  ctx.drawImage(video,0,0,canvas.width,canvas.height);

  const ball=detectBall(ctx);
  if(ball) trackBall(ball);

  // For demo: simulate OCR number detection every second
  if(Math.random()<0.05){
    const num=await detectNumber(ctx);
    if(num>=0 && num<=36 && num!==lastNumber){
      lastNumber=num;
      history.push(num);
      if(history.length>100) history.shift();
      updatePredictions();
    }
  }

  requestAnimationFrame(analyzeFrame);
}

// ===== Predictions =====
function updatePredictions(){
  if(history.length===0) return;
  // Frequency analysis
  const counts=Array(37).fill(0);
  history.forEach(n=>counts[n]+=1);
  const sorted=counts.map((v,i)=>({num:i,count:v})).sort((a,b)=>b.count-a.count);

  topSectors=sorted.slice(0,3).map(x=>x.num);

  // Top neighbors: 5 numbers around top 3
  const neighborSet=new Set();
  for(let n of topSectors){
    const idx=wheel.indexOf(n);
    [wheel[(idx-1+37)%37], wheel[(idx+1)%37]].forEach(x=>{
      if(neighborSet.size<5 && !topSectors.includes(x)) neighborSet.add(x);
    });
  }
  topNeighbors=Array.from(neighborSet);

  document.getElementById('ballSpeed').innerText="Ball Speed: "+currentSpeed.toFixed(2)+" rad/s";
  document.getElementById('lastNumbers').innerText="Last Numbers: "+history.slice(-10).join(", ");
  document.getElementById('prediction').innerText="Next Prediction: "+sorted[0].num;
  document.getElementById('topSectors').innerText="Top 3 Sectors: "+topSectors.join(", ");
  document.getElementById('topNeighbors').innerText="Top 5 Neighbors: "+topNeighbors.join(", ");
}

// Start
video.onloadedmetadata=()=>analyzeFrame();
</script>
</body>
</html>
