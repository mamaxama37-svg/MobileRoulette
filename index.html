<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Intelligent Mobile Roulette Analyzer</title>
<style>
body { background:#000; color:#fff; font-family:sans-serif; margin:0; text-align:center; }
header { background:#111; padding:12px; font-size:1.3em; }
#videoContainer { position:relative; margin:10px auto; width:100%; max-width:400px; }
video { width:100%; border:2px solid #fff; }
canvas { display:none; }
#controls, #results { margin:10px; }
input { width:42px; padding:4px; margin:2px; }
button { padding:6px 12px; margin:5px; font-size:1em; }
#last100, #last14 { max-height:80px; overflow:auto; margin-top:5px; }
#prediction { font-size:1.2em; margin-top:10px; }
.hot { color:#f00; } .cold { color:#0f0; } .neighbor { color:#ff0; font-weight:bold; }
</style>
</head>
<body>

<header>Intelligent Mobile Roulette Analyzer</header>

<div id="videoContainer">
  <video id="rouletteVideo" autoplay playsinline></video>
</div>

<div id="controls">
  <button onclick="capture100Numbers()">Capture Last 100 Numbers</button>
  <div>
    <b>Manual Last 14 Numbers:</b><br>
    <div id="last14Inputs"></div>
    <button onclick="applyLast14()">Apply Last-14 Momentum</button>
  </div>
</div>

<div id="results">
  <div id="last100">Last 100 Numbers: --</div>
  <div id="prediction">Prediction: --</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
<script>
/* ===== WHEEL MODEL ===== */
const wheel = [0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,
               30,8,23,10,5,24,16,33,1,20,14,31,9,
               22,18,29,7,28,12,35,3,26];

let last100Numbers = [];
let last14Numbers = [];
let prediction = { number:null, neighbor:null };

/* ===== CREATE LAST 14 INPUTS ===== */
const last14Holder = document.getElementById("last14Inputs");
for(let i=0;i<14;i++){
  const inp = document.createElement("input");
  inp.type="number"; inp.min=0; inp.max=36;
  last14Holder.appendChild(inp);
}

/* ===== LIVE CAMERA ===== */
const video = document.getElementById("rouletteVideo");
const canvas = document.createElement("canvas");
const ctx = canvas.getContext("2d");

async function initCamera() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" }, audio:false });
    video.srcObject = stream;
  } catch(err) {
    alert("Camera initialization failed: "+err);
  }
}
initCamera();

/* ===== CAPTURE 100 NUMBERS ===== */
async function capture100Numbers() {
  if(video.readyState < 2) return alert("Camera not ready");
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  ctx.drawImage(video,0,0,canvas.width,canvas.height);
  document.getElementById("last100").innerText = "OCR scanning...";
  
  try {
    const result = await Tesseract.recognize(canvas, 'eng', { logger:m=>console.log(m) });
    let nums = result.data.text.match(/\b([0-9]|[1-2][0-9]|3[0-6])\b/g);
    if(!nums || nums.length<100) return alert("OCR failed: not enough numbers detected");
    last100Numbers = nums.map(Number).slice(-100);
    document.getElementById("last100").innerText = "Last 100 Numbers: "+last100Numbers.join(", ");
    runPrediction();
  } catch(e) {
    alert("OCR error: "+e);
  }
}

/* ===== APPLY LAST 14 ===== */
function applyLast14(){
  const inputs = [...document.querySelectorAll("#last14Inputs input")];
  last14Numbers = inputs.map(i=>Number(i.value)).filter(n=>!isNaN(n));
  if(last14Numbers.length<1) return alert("Enter at least 1 number for momentum");
  runPrediction();
}

/* ===== INTELLIGENT PREDICTION ===== */
function runPrediction(){
  if(last100Numbers.length===0) return;
  
  // Frequency + neighbor scoring
  const scores = Array(37).fill(0);
  
  last100Numbers.forEach(n=>{
    scores[n]+=3; // frequency weight
    const idx = wheel.indexOf(n);
    for(let i=-1;i<=1;i++){
      const neighbor = wheel[(idx+i+wheel.length)%wheel.length];
      scores[neighbor]+=1; // neighbor weight
    }
  });
  
  last14Numbers.forEach(n=>{
    scores[n]+=2; // momentum weight
  });
  
  // Find top number
  let maxScore = Math.max(...scores);
  const topNumbers = [];
  scores.forEach((s,i)=>{ if(s===maxScore) topNumbers.push(i); });
  const nextNumber = topNumbers[Math.floor(Math.random()*topNumbers.length)];
  
  // Find best neighbor (1 neighbor)
  const idx = wheel.indexOf(nextNumber);
  const neighbors = [wheel[(idx-1+wheel.length)%wheel.length], wheel[(idx+1)%wheel.length]];
  let neighborScore = neighbors.map(n=>scores[n]);
  const bestNeighbor = neighbors[neighborScore[0]>=neighborScore[1]?0:1];
  
  prediction.number = nextNumber;
  prediction.neighbor = bestNeighbor;
  
  document.getElementById("prediction").innerHTML = 
    `<b>Next Number Prediction:</b> <span class="hot">${nextNumber}</span> | <b>Neighbor:</b> <span class="neighbor">${bestNeighbor}</span>`;
}
</script>

</body>
</html>
